# Leapcell.io deployment configuration
# For more information, see: https://docs.leapcell.io/

name: interviewmin-api
runtime: go

build:
  # The build command compiles the Go application with optimizations
  # -tags netgo: Use pure Go DNS resolver for portability
  # -ldflags: Inject version information and strip debug symbols for smaller binary
  command: |
    go mod tidy && go build -tags netgo -ldflags "-s -w \
      -X main.version=$(git describe --tags --always --dirty 2>/dev/null || echo 'v0.0.0') \
      -X main.commit=$(git rev-parse --short HEAD 2>/dev/null || echo 'unknown') \
      -X main.buildTime=$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
      -o app ./cmd/api

# The command to start your application
start: ./app

# Port your application listens on (must match your PORT env var)
port: 8080

# Health check configuration
healthcheck:
  path: /v1/healthcheck
  interval: 30s
  timeout: 5s
# Environment variables (configure these in Leapcell dashboard)
# Required environment variables:
# - ENV: production
# - PORT: 8080
# - DATABASE_URL: your PostgreSQL connection string
# - JWT_SECRET: your JWT secret (min 32 characters)
# - AES_SECRET_KEY: your AES encryption key (16, 24, or 32 bytes)
# - GROQ_API_KEY: your Groq API key
# - CORS_TRUSTED_ORIGINS: comma-separated list of allowed origins
#
# Optional environment variables:
# - DB_MAX_OPEN_CONNS: default 25
# - DB_MAX_IDLE_CONNS: default 25
# - DB_MAX_IDLE_TIME: default 15m
# - RATE_LIMIT_RPS: default 10
# - RATE_LIMIT_BURST: default 20
# - RATE_LIMIT_ENABLED: default true
# - JWT_ACCESS_TOKEN_TTL: default 15m
# - JWT_REFRESH_TOKEN_TTL: default 168h (7 days)
# - GROQ_MODEL: default meta-llama/llama-4-maverick-17b-128e-instruct
# - GROQ_TIMEOUT: default 30s
